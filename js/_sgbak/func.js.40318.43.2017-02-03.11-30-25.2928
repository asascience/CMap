$(document).ready(function () {
    var serviceURLslocal = { fileslist: "http://localhost/CMapService/Service.svc/GetFilesList", inspectionslist: "http://localhost/CMapService/Service.svc/GetInspectionsList", inspectionshistory: "http://localhost/CMapService/Service.svc/GetInspectionsHistory", uploadinspectionhistory: "http://localhost/CMapService/Service.svc/uploadinspectionhistory", uploadcustomfile: "http://localhost/CMapService/Service.svc/UploadCustomFile", fixuploadfile: "http://localhost/CMapService/Service.svc/FixUploadedFile" };

    var serviceURLsProd = { fileslist: "http://tct.reservoirkb.com/CMapService/Service.svc/GetFilesList", inspectionslist: "http://tct.reservoirkb.com/CMapService/Service.svc/GetInspectionsList", inspectionshistory: "http://tct.reservoirkb.com/CMapService/Service.svc/GetInspectionsHistory", uploadinspectionhistory: "http://tct.reservoirkb.com/CMapService/Service.svc/uploadinspectionhistory", uploadcustomfile: "http://tct.reservoirkb.com/CMapService/Service.svc/UploadCustomFile", fixuploadfile: "http://tct.reservoirkb.com/CMapService/Service.svc/FixUploadedFile" };
    var serviceURLs = serviceURLslocal;
    
    var category = [
                    { text: "AIR", value: "AIR" },
                    { text: "WASTE", value: "WASTE" },
                    { text: "WATER", value: "WATER" },
                     { text: "OTHER", value: "OTHER" }
    ];


    var SubCat_type = [
                  { text: "REGULATIONS", value: "REGULATIONS" },
                  { text: "PERMITS", value: "PERMITS" },
                  { text: "GUIDANCE", value: "GUIDANCE" },
                   { text: "DESIGN", value: "DESIGN" },
                    { text: "RECORDS/DATA", value: "RECORDS/DATA" },

    ];
    $("#category").height(20).kendoDropDownList({
       
        dataTextField: "text",
        dataValueField: "value",
        dataSource: category,
        index: 0,
        change: oncategoryChange

    });

    $("#subcategory").height(20).kendoDropDownList({
        dataTextField: "text",
        dataValueField: "value",
        dataSource: SubCat_type,
        index: 0,
        change: onSubCat_typeChange

    });
    $("#tabstrip").kendoTabStrip({
        animation: {
            open: {
                effects: "fadeIn"
            }
        }
    });
    

  
    oncategoryChange();
    function oncategoryChange() {
       
        var uesrid = "2"; var Type = "POST";
        var Url = serviceURLs["fileslist"];;
        var Data = '{"Id": "' + uesrid + '"}';
        var ContentType = "application/json; charset=utf-8";
        var DataType = "json";

        $.ajax({
            type: Type,
            url: Url,
            data: Data,
            contentType: ContentType,
            dataType: DataType,
            processdata: true,
            success: function (msg) {
               LoadFilesListSucceeded(msg);
                //alert("success");
            },
            error: ServiceFailed// When Service call fails
        });

       
       


       
    };

    function reportMenu(node) {
        alert('Node id ' + node.id);
        // build your menu depending on node id
        return {
            createItem: {
                "label": "Create New Branch",
                "action": function (obj) { this.create(obj); alert(obj.text()) },
                "_class": "class"
            },
            renameItem: {
                "label": "Rename Branch",
                "action": function (obj) { this.rename(obj); }
            },
            deleteItem: {
                "label": "Remove Branch",
                "action": function (obj) { this.remove(obj); }
            }
        };
    }

    function LoadFilesListSucceeded(result) {



        var dropdownlist = $("#category").data("kendoDropDownList");

        var dropdownSubCat_type = $("#subcategory").data("kendoDropDownList");

        var category = $("#category").data("kendoDropDownList").value();

        var SubCat_type = $("#subcategory").data("kendoDropDownList").value();

        resultObject = eval(result.GetFilesListResult);

        console.log(resultObject);


       

        var json = [];



        var tblAirRegulationsJSON = JSLINQ(resultObject)
      .Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "REGULATIONS"; });

        var tblAirpermitsJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "PERMITS"; });
        var tblAirguidanceJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "GUIDANCE"; });


        var tblAirdesignJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "DESIGN"; });


        var tblAirrecordsdataJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "RECORDS/DATA"; });


        var tblwasteRegulationsJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "REGULATIONS"; });


        var tblwastepermitsJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "PERMITS"; });


        var tblwasteguidanceJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "GUIDANCE"; });


        var tblwastedesignJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "DESIGN"; });


        var tblwasterecordsdataJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "RECORDS/DATA"; });


        var tblwaterRegulationsJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "REGULATIONS"; });


        var tblwaterpermitsJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "PERMITS"; });


        var tblwaterguidanceJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "GUIDANCE"; });


        var tblwaterdesignJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "DESIGN"; });


        var tblwaterrecordsdataJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "RECORDS/DATA"; });


        var tblotherRegulationsJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "REGULATIONS"; });

        var tblotherpermitsJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "PERMITS"; });


        var tblotherguidanceJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "GUIDANCE"; });


        var tblotherdesignJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "DESIGN"; });


        var tblotherrecordsdataJSON = JSLINQ(resultObject)
        .Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "RECORDS/DATA"; });

        if (category == "AIR" && SubCat_type == "REGULATIONS") {
           
            json = tblAirRegulationsJSON;

            
        }
        if (category == "AIR" && SubCat_type == "PERMITS") {
            json = tblAirpermitsJSON;
        }
        if (category == "AIR" && SubCat_type == "GUIDANCE") {
            json = tblAirguidanceJSON;
        }
        if (category == "AIR" && SubCat_type == "DESIGN") {
            json = tblAirdesignJSON;
        }
        if (category == "AIR" && SubCat_type == "RECORDS/DATA") {
            json = tblAirrecordsdataJSON;
        }

        //
        if (category == "WASTE" && SubCat_type == "REGULATIONS") {
            json = tblwasteRegulationsJSON;
        }
        if (category == "WASTE" && SubCat_type == "PERMITS") {
            json = tblwastepermitsJSON;
        }
        if (category == "WASTE" && SubCat_type == "GUIDANCE") {
            json = tblwasteguidanceJSON;
        }
        if (category == "WASTE" && SubCat_type == "DESIGN") {
            json = tblwastedesignJSON;

        }
        if (category == "WASTE" && SubCat_type == "RECORDS/DATA") {
            json = tblwasterecordsdataJSON;
        }
        //

        if (category == "WATER" && SubCat_type == "REGULATIONS") {
            json = tblwaterRegulationsJSON;
        }
        if (category == "WATER" && SubCat_type == "PERMITS") {
            json = tblwaterpermitsJSON;
        }
        if (category == "WATER" && SubCat_type == "GUIDANCE") {
            json = tblwaterguidanceJSON;
        }
        if (category == "WATER" && SubCat_type == "DESIGN") {
            json = tblwaterdesignJSON;
        }
        if (category == "WATER" && SubCat_type == "RECORDS/DATA") {
            json = tblwaterrecordsdataJSON;
        }
        //
        if (category == "OTHER" && SubCat_type == "REGULATIONS") {
            json = tblotherRegulationsJSON;
        }
        if (category == "OTHER" && SubCat_type == "PERMITS") {
            json = tblotherpermitsJSON;

        }
        if (category == "OTHER" && SubCat_type == "GUIDANCE") {
            json = tblotherguidanceJSON;
        }
        if (category == "OTHER" && SubCat_type == "DESIGN") {
            json = tblotherdesignJSON;
        }
        if (category == "OTHER" && SubCat_type == "RECORDS/DATA") {
            json = tblotherrecordsdataJSON;
        }

       
     

      $("#divcategorysubcategory").jstree("destroy");
      $('#divcategorysubcategory').jstree({
            "core": {
                'animation' : 0,
                'strings' : {
                    new_node : 'The text you want', //this text will change the label when you create a new node
                },
                'data': (json.items),
                "check_callback": function (operation, node, parent, position, more) {
                    //console.log(operation);
                    if (operation === "copy_node" || operation === "move_node") {
                        if (parent.id === "#") {
                            return false; // prevent moving a child above or below the root
                        }
                    }

                    if (operation === "rename_node")
                    {
                        var x = document.getElementById("uploadFiles");
                        var file = x.files[0];
                        var fileData = file;

                        var dropdownlist = $("#category").data("kendoDropDownList");

                        var dropdownSubCat_type = $("#SubCat_type").data("kendoDropDownList");

                        var category = dropdownlist.select();

                        var SubCat_type = dropdownSubCat_type.select();

                        if (category == "0" && SubCat_type == "0") {
                            category = 'AIR';
                            SubCat_type = 'REGULATIONS'
                        }
                        if (category == "0" && SubCat_type == "1") {
                            category = 'AIR';
                            SubCat_type = 'PERMITS'
                        }
                        if (category == "0" && SubCat_type == "2") {
                            category = 'AIR';
                            SubCat_type = 'GUIDANCE'
                        }
                        if (category == "0" && SubCat_type == "3") {
                            category = 'AIR';
                            SubCat_type = 'DESIGN'
                        }
                        if (category == "0" && SubCat_type == "4") {
                            category = 'AIR';
                            SubCat_type = 'RECORDS/DATA'
                        }

                        //
                        if (category == "1" && SubCat_type == "0") {
                            category = 'WASTE';
                            SubCat_type = 'REGULATIONS'
                        }
                        if (category == "1" && SubCat_type == "1") {
                            category = 'WASTE';
                            SubCat_type = 'PERMITS'
                        }
                        if (category == "1" && SubCat_type == "2") {
                            category = 'WASTE';
                            SubCat_type = 'GUIDANCE'
                        }
                        if (category == "1" && SubCat_type == "3") {
                            category = 'WASTE';
                            SubCat_type = 'DESIGN'

                        }
                        if (category == "1" && SubCat_type == "4") {
                            category = 'WASTE';
                            SubCat_type = 'RECORDS/DATA'
                        }
                        //

                        if (category == "2" && SubCat_type == "0") {
                            category = 'WATER';
                            SubCat_type = 'REGULATIONS'
                        }
                        if (category == "2" && SubCat_type == "1") {
                            category = 'WATER';
                            SubCat_type = 'PERMITS'
                        }
                        if (category == "2" && SubCat_type == "2") {
                            category = 'WATER';
                            SubCat_type = 'GUIDANCE'
                        }
                        if (category == "2" && SubCat_type == "3") {
                            category = 'WATER';
                            SubCat_type = 'DESIGN'
                        }
                        if (category == "2" && SubCat_type == "4") {
                            category = 'WATER';
                            SubCat_type = 'RECORDS/DATA'
                        }
                        //
                        if (category == "3" && SubCat_type == "0") {
                            category = 'OTHER';
                            SubCat_type = 'REGULATIONS'
                        }
                        if (category == "3" && SubCat_type == "1") {
                            category = 'OTHER';
                            SubCat_type = 'PERMITS'

                        }
                        if (category == "3" && SubCat_type == "2") {
                            category = 'OTHER';
                            SubCat_type = 'GUIDANCE'
                        }
                        if (category == "3" && SubCat_type == "3") {
                            category = 'OTHER';
                            SubCat_type = 'DESIGN'
                        }
                        if (category == "3" && SubCat_type == "4") {
                            category = 'OTHER';
                            SubCat_type = 'RECORDS/DATA'
                        }
                        var Url = serviceURLs["uploadcustomfile"];

                        var parent = $("#divcategorysubcategory").jstree().get_selected(true)[0].parent;

                       // alert(parent);
                        $.ajax({
                            url: Url,
                            type: 'POST',
                            data: fileData,
                            cache: false,
                            dataType: 'json',
                            processData: false, // Don't process the files
                            contentType: false, // Set content type to false as jQuery will tell the server its a query string request
                            success: function (data) {
                                UploadFileServiceSucceeded(data, node.text, category, SubCat_type, parent, "Folder");

                            },
                            error: function (result) {
                                alert('Service call failed: ' + result.status + '' + result.statusText);
                            }
                        });

                    }
                    return true; // allow everything else
                }
            },
            "plugins": ["dnd", "contextmenu"]
        });


        $('.vakata-context jstree-contextmenu jstree-default-contextmenu').css('left', '0px');

    }
    function onSubCat_typeChange() {
       
        var uesrid = "2"; var Type = "POST";
        var Url = serviceURLs["fileslist"];;
        var Data = '{"Id": "' + uesrid + '"}';
        var ContentType = "application/json; charset=utf-8";
        var DataType = "json";

        $.ajax({
            type: Type,
            url: Url,
            data: Data,
            contentType: ContentType,
            dataType: DataType,
            processdata: true,
            success: function (msg) {
                LoadFilesListSucceeded(msg);
                //alert("success");
            },
            error: ServiceFailed// When Service call fails
        });



    };
  
	var winW = $(window).width();

	var winheight = $(window).height();

	$('#divDashBoard').css('width', winW - 360);

	$('#divDashBoard').css('left', winW / 2 - $('#divDashBoard').width() / 2 - 20);

	$('#divFC1').css('width', winW - 600);

	$('#chartContainer').css('width', winW - 600);


	  var FCWindow = $("#divFC");
	  var PI = $("#divps");
	  var PI1 = $("#divps1");
	  var ETInspectWindow = $("#divETInspections");
	  var ETCalendarWindow=$("#divETCalendar") ;
	  var detailsWindow = $("#details");
	  //---------------------------------------------------------------------------------
	ETCalendarWindow.kendoWindow({
	    position: {
			top: 100, // or "100px"
			left: winW / 2 - $('#divDashBoard').width() / 2 +40
		  },
        width:winW-500,
	    height:700,
        title: "Event Tickler - Calendar",
        visible: false,
        actions: [                           
             "Close"
         ]
                       
          });
	//---------------------------------------------------------------------------------
	ETInspectWindow.kendoWindow({
	    position: {
			top: 100, // or "100px"
			left: winW / 2 - $('#divDashBoard').width() / 2 +40
		  },
        width:winW-500,
	    height:700,
        title: "Event Tickler - Inspections",
        visible: false,
        actions: [                           
             "Close"
         ]
                       
          });
 //---------------------------------------------------------------------------------
   FCWindow.kendoWindow({
	    position: {
			top: 100, // or "100px"
			left: winW / 2 - $('#divDashBoard').width() / 2 +40
		  },
        width:winW-500,
	    height:600,
        title: "File Cabinet",
        visible: false,
        actions: [                           
             "Close"
         ]
                       
          });
//---------------------------------------------------------------------------------
PI.kendoWindow({
	    position: {
    top: 100, // or "100px"
    left: winW / 2 - $('#divDashBoard').width() / 2 +40
  },
                        width:winW-500,
						height:500,
                        title: "",
                        visible: false,
                        actions: [                           
                            "Close"
                        ],
                       
                    });
//---------------------------------------------------------------------------------
PI1.kendoWindow({
	    position: {
    top: 100, // or "100px"
    left: winW / 2 - $('#divDashBoard').width() / 2 +40
  },
                        width:winW-500,
						height:500,
                        title: "Annual volume displaced - 12 month rolling average",
                        visible: false,
                        actions: [                           
                            "Close"
                        ],
                       
                    });
    //---------------------------------------------------------------------------------

detailsWindow.kendoWindow({
    position: {
        top: 250, // or "100px"
        left: winW / 8 - $('#details').width() / 2 -10
    },
    width: winW - 500,
    height: 300,
    title: "Comments Details",
    visible: false,
    actions: [
        "Close"
    ],

});
    //---------------------------------------------------------------------------------


 $("#divFC1").tabs();
              $("#airpermits").tabs().addClass("ui-tabs-vertical ui-helper-clearfix");
              $("#airpermits li").removeClass("ui-corner-top").addClass("ui-corner-left");


              $("#wastepermits").tabs().addClass("ui-tabs-vertical ui-helper-clearfix");
              $("#wastepermits li").removeClass("ui-corner-top").addClass("ui-corner-left");


              $("#waterpermits").tabs().addClass("ui-tabs-vertical ui-helper-clearfix");
              $("#waterpermits li").removeClass("ui-corner-top").addClass("ui-corner-left");


              $("#otherpermits").tabs().addClass("ui-tabs-vertical ui-helper-clearfix");
              $("#otherpermits li").removeClass("ui-corner-top").addClass("ui-corner-left");

//---------------------------------------------------------------------------------          

 
function loadchartdata()
{
    var dps = [
        { x: 2010, y: 1000000 },

         { x: 2011, y: 2000000 },

          { x: 2012, y: 4000000 },

           { x: 2013, y: 5000000 },

            { x: 2014, y: 8000000 },

             { x: 2015, y: 9000000 },

              { x: 2016, y: 10000000 },



    ]; // dataPoints

    var p = 0;
    var dps = [
				{ x: new Date(2007, 0, 3), y: 1000000 },
				{ x: new Date(2008, 0, 5), y: 3000000 },
				{ x: new Date(2009, 0, 7), y: 5000000 },
				{ x: new Date(2010, 0, 9), y: 7000000 },
				{ x: new Date(2011, 0, 11), y: 9000000 },
				{ x: new Date(2012, 0, 13), y: 10000000 },
				{ x: new Date(2013, 0, 15), y: 4000000 },
				{ x: new Date(2014, 0, 17), y: 3000000 },
				{ x: new Date(2015, 0, 19), y: 2000000 },
				{ x: new Date(2016, 0, 21), y: 1000000 },
				{ x: new Date(2017, 0, 23), y: 5000000 }
    ];

    var chart = new CanvasJS.Chart("chartContainer", {
        title: {
            text: ""
        },
		width:800,
        data: [{
            type: "line",
            dataPoints:dps
        }]
    });
    chart.render();
   
   
    var xVal = dps[p].x;
    var yVal = dps[p].y;
    var updateInterval = 1000;

    var updateChart = function () {
       

        yVal = dps[p].y;
        xVal = dps[p].x;
        dps.push({ x: xVal, y: yVal, });

        console.log(dps);

        p++;
        if (dps.length > 10) {
            p = 0;
        }
        chart.render();

        // update chart after specified time. 

    };
    setInterval(function () { updateChart() }, updateInterval);

   
}
//---------------------------------------------------------------------------------
function loadchartdataps1() {
    var json = [
 { "year": 2007, "value": 100000 },
 { "year": 2008, "value": 200000 },
 { "year": 2009, "value": 300000 },
  { "year": 2010, "value": 400000 },
  { "year": 2011, "value": 450000 },
   { "year": 2012, "value": 500000 },
    { "year": 2013, "value": 600000 },
     { "year": 2014, "value": 700000 },
       { "year": 2015, "value": 800000 },
       { "year": 2016, "value": 900000 },

    ];
    var year=0;
    FusionCharts.ready(function () {

       
        var fusioncharts = new FusionCharts({
            type: 'cylinder',
            dataFormat: 'json',
            id: 'fuelMeter-4',
            renderAt: 'ps1',
            width: '500',
            height: '500',
            dataSource: {
                "chart": {
                    "theme": "fint",
                    "caption": "",
                    "subcaption": "",
                    "lowerLimit": "0",
						"upperLimit": "1000000",
                    "lowerLimitDisplay": "Empty",
                    "upperLimitDisplay": "Full",
                    "numberSuffix": " Gallons",
                    "showValue": "0",
                    "chartBottomMargin": "180",
                     "chartLeftMargin": "100"
                },
                "value": "110",

                "annotations": {
                    "origw": "400",
                    "origh": "190",
                    "autoscale": "1",
                    "groups": [{
                        "id": "range",
                        "items": [{
                            "id": "rangeBg",
                            "type": "rectangle",
                            "x": "$canvasCenterX-125",
                            "y": "$chartEndY-50",
                            "tox": "$canvasCenterX +145",
                            "toy": "$chartEndY-95",
                            "fillcolor": "#FFFFFF"
                        }, {
                            "id": "rangeText",
                            "type": "Text",
							"align":"center",
                            "fontSize": "15",
                            "fillcolor": "#FFFFFF",
                            "text": "Volume : 110 Gallons",
                            "x": "$chartCenterX",
                            "y": "$chartEndY-70"
                        }]
                    }]
                }
            },
            "events": {
                "rendered": function (evtObj, argObj) {
                    var gaugeRef = evtObj.sender,
                        fuelVolume = 0;
                    
                   

                      var i = 0;
                    gaugeRef.chartInterval = setInterval(function () {
                        //console.log(i);
                       
                        if (i == json.length)
                        {
                            i = 0;
                        } else
                            {

                      
                          
                            var x=parseInt(json[i].value.toString());
                          
                             //   gaugeRef.setChartAttribute('cylFillColor', '#008000');
                                gaugeRef.feedData("&value=" + x);
                            
                            year = json[i].year
                        i++;
                        }
                       

                    }, 1000);
                },
                //Using real time update event to update the annotation
                //showing available volume of Diesel
                "realTimeUpdateComplete": function (evt, arg) {
					var gaugeRef = evt.sender;
                 

                    var annotations = evt.sender.annotations,
                        dataVal = evt.sender.getData();
                   
                    var forecolorval = "#FFFFFF";
                      //alert(dataVal);
                        
                       // colorVal = (dataVal >= 500000) ? "#6caa03" : ((dataVal <= 500000) ? "#008000" : "#f8bd1b");
                   // console.log(dataVal);
                    if (dataVal <= 500000)
                    {
                        colorVal = "#008000";
                        forecolorval = "#FFFFFF";
                        
                    }

                    if (dataVal > 500000 && dataVal <=800000) {
                        colorVal = "#FFFF00";
                        forecolorval = "#000000";
                    }

                    if (dataVal >= 800000) {
                        colorVal = "#FF0000";
                        forecolorval = "#FFFFFF";
                    }

                    //Updating value
                    annotations && annotations.update('rangeText', {

                        "text": " Volume: " + dataVal + " Gallons @ " + year,
                        "fillcolor": forecolorval
                        

                    });
                    //Changing background color as per value
                    annotations && annotations.update('rangeBg', {
                        "fillcolor": colorVal
                    });


                   
                },
                "disposed": function (evt, arg) {
                    clearInterval(evt.sender.chartInterval);
                }
            }
        }
    );
        fusioncharts.render();
    });


}

//---------------------------------------------------------------------------------
function getScreenWidth() {
    var height = window.innerHeight;
    var myHeight;
    if (typeof (window.innerWidth) == 'number') {
        //Non-IE
        myWidth = window.innerWidth;
    }
    else if (document.documentElement && (document.documentElement.clientWidth || document.documentElement.clientHeight)) {
        //IE 6+ in 'standards compliant mode'
        myWidth = document.documentElement.clientWidth;
    }
    else if (document.body && (document.body.clientWidth || document.body.clientHeight)) {
        //IE 4 compatible
        myWidth = document.body.clientWidth;
    }
    height = myWidth;
    return height;
	
}
$("#btnFCSearch").click(function(){    
//alert("results");

    document.getElementById("divFCSearchResults").style.display = "block";

});
//---------------------------------------------------------------------------------
$("#btnFC1").click(function(){    
  
  FCWindow.data("kendoWindow").open();
		LoadAllFiles();
});
//---------------------------------------------------------------------------------

//---------------------------------------------------------------------------------
$("#btnpi").click(function () {
  
    PI.data("kendoWindow").open();
   
    loadchartdata();
});
//---------------------------------------------------------------------------------
$("#btnpis").click(function () {
   
    PI1.data("kendoWindow").open();
	
    loadchartdataps1();
});
//---------------------------------------------------------------------------------
    $("#btnFC").click(function(){
	
        $('#divFC').css("display", "block");
		LoadAllFiles();
    });
//---------------------------------------------------------------------------------
	$("#btnWeather").click(function(){
	
        $('#divWeather').css("display", "block");
		
    });
//---------------------------------------------------------------------------------
	$("#btnSO").click(function(){
	
        $('#divSelectObjects').css("display", "block");
		
    });
	
///////////////////////////////////////////////////////////////////////////////
            function LoadAllFiles() {
                var uesrid = "2"; var Type = "POST";              
			  var Url=serviceURLs["fileslist"];			  ;
                var Data = '{"Id": "' + uesrid + '"}';
                var ContentType = "application/json; charset=utf-8";
                var DataType = "json";

                $.ajax({
                    type: Type,
                    url: Url,
                    data: Data,
                    contentType: ContentType,
                    dataType: DataType,
                    processdata: true,
                    success: function (msg) {
                        GetFilesListSucceeded(msg);
						//alert("success");
                    },
                    error: ServiceFailed// When Service call fails
                });
            }
            ////////////////////////////////////////////////////////////////////////////////////////////////
            function ServiceFailed(result) {
	alert('Service call failed: ' + result.status + '' + result.statusText);
                Type = null; Url = null; Data = null; ContentType = null; DataType = null; ProcessData = null;
            }
//////////////////////////////////////////////////////////////////////////////////////////////////////////        

            function GetFilesListSucceeded(result) {                
                resultObject = eval(result.GetFilesListResult);

var tblAirRegulationsJSON = JSLINQ(resultObject)
   .Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "REGULATIONS"; });

var tblAirpermitsJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "PERMITS"; });
var tblAirguidanceJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "GUIDANCE"; });


var tblAirdesignJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "DESIGN"; });


var tblAirrecordsdataJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "AIR" && item.SubCat_type == "RECORDS/DATA"; });


var tblwasteRegulationsJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "REGULATIONS"; });


var tblwastepermitsJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "PERMITS"; });


var tblwasteguidanceJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "GUIDANCE"; });


var tblwastedesignJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "DESIGN"; });


var tblwasterecordsdataJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WASTE" && item.SubCat_type == "RECORDS/DATA"; });


var tblwaterRegulationsJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "REGULATIONS"; });


var tblwaterpermitsJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "PERMITS"; });


var tblwaterguidanceJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "GUIDANCE"; });


var tblwaterdesignJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "DESIGN"; });


var tblwaterrecordsdataJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "WATER" && item.SubCat_type == "RECORDS/DATA"; });


var tblotherRegulationsJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "REGULATIONS"; });

var tblotherpermitsJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "PERMITS"; });


var tblotherguidanceJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "GUIDANCE"; });


var tblotherdesignJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "DESIGN"; });


var tblotherrecordsdataJSON = JSLINQ(resultObject)
.Where(function (item) { return item.Cat_Name == "OTHER" && item.SubCat_type == "RECORDS/DATA"; });


//console.log(JSON.stringify(tblAirRegulationsJSON.items));

//air
loadtree("#tblAirRegulations", tblAirRegulationsJSON)

loadtree("#tblAirpermits", tblAirpermitsJSON)

loadtree("#tblAirguidance", tblAirguidanceJSON)

loadtree("#tblAirpermitdesign", tblAirdesignJSON)

loadtree("#tblAirrecordsdata", tblAirrecordsdataJSON)
                //waste
loadtree("#tblwaterRegulations", tblwaterRegulationsJSON)

loadtree("#tblwaterpermitdesign", tblwaterdesignJSON)

loadtree("#tblwaterguidance", tblwaterguidanceJSON)

loadtree("#tblwaterpermitdesign", tblwaterdesignJSON)

loadtree("#tblwaterrecordsdata", tblwaterrecordsdataJSON)



                //water
loadtree("#tblwasteRegulations", tblwasteRegulationsJSON)

loadtree("#tblwastepermits", tblwastepermitsJSON)

loadtree("#tblwasteguidance", tblwasteguidanceJSON)

loadtree("#divFCSearchResults", tblwasteguidanceJSON)

loadtree("#tblwastepermitdesign", tblwastedesignJSON)

loadtree("#tblwasterecordsdata", tblwasterecordsdataJSON)

                //other

loadtree("#tblotherRegulations", tblotherRegulationsJSON)

loadtree("#tblotherpermits", tblotherpermitsJSON)

loadtree("#tblotherguidance", tblotherguidanceJSON)

loadtree("#tblotherpermitdesign", tblotherdesignJSON)

loadtree("#tblotherrecordsdata", tblotherrecordsdataJSON)


               


               
            }

            function loadtree(divtreename,json)
            {

                $(divtreename).on('changed.jstree', function (e, data) {

                    console.log(data.node.text);
                    
                  
                    var i, j, r = [];
                    for (i = 0, j = data.selected.length; i < j; i++) {
                        r.push(data.instance.get_node(data.selected[i]).text);
                    }

                    var str = data.node.text;
                    if (str.indexOf(".") != -1) {
                        window.open('filecabinet/' + r.join(', '), '_blank');
                    }
                   
                }).jstree({
                    'core': {
                        'data': (json.items)
                    }
               

                });

               

               
            }
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////			   
            $('#btnUpload').click(function () {

                $('#divUpload').css("display", "block");
                $('#divFC1').css("display", "none");
            });
            ///////////////////////////////////////////////////////////////////////////////////	  
            $('#btnFileCabinet').click(function () {
                $('#divUpload').css("display", "none");
                $('#divFC1').css("display", "block");
            });
			///////////////////////////////////////////////////////////////////////////////
			$('#imgCloseFC').click(function () {			
				$('#divFC').css("display", "none");
			});
				$('#imgCloseW').click(function () {			
				$('#divWeather').css("display", "none");
			});
			$('#imgCloseSO').click(function () {			
				$('#divSelectObjects').css("display", "none");
			});
            ///////////////////////////////////////////////////////////////////////////////
			   $('#thair').click(function () {
                $('#tblWasteFiles').css("display", "none");
                $('#tblAirFiles').css("display", "block");
                $('#tblWaterFiles').css("display", "none");
                $('#tblOtherFiles').css("display", "none");
				 showTabSelection($('#thair'));
            });
			
            $('#thwaste').click(function () {
                $('#tblWasteFiles').css("display", "block");
                $('#tblAirFiles').css("display", "none");
                $('#tblWaterFiles').css("display", "none");
                $('#tblOtherFiles').css("display", "none");
				 showTabSelection($('#thwaste'));
            });
            $('#thwater').click(function () {
                $('#tblWasteFiles').css("display", "none");
                $('#tblAirFiles').css("display", "none");
                $('#tblWaterFiles').css("display", "block");
                $('#tblOtherFiles').css("display", "none");				 
				 showTabSelection($('#thwater'));
            });
            $('#thother').click(function () {
                $('#tblWasteFiles').css("display", "none");
                $('#tblAirFiles').css("display", "none");
                $('#tblWaterFiles').css("display", "none");
                $('#tblOtherFiles').css("display", "block");				
				 showTabSelection($('#thother'));
            });
			///////////////////////////////////////////////////////////////////////////////
			 function onChange() {
                    alert("hello");
                    //kendoConsole.log("Change :: " + kendo.toString(this.value(), 'd'));
                }
			 $('#btnETCalendar').click(function () {
				 var today = new Date();
				 var    events = [
                           +new Date(today.getFullYear(), today.getMonth(), 8),
                           +new Date(today.getFullYear(), today.getMonth(), 12),
                           +new Date(today.getFullYear(), today.getMonth(), 24),
                           +new Date(today.getFullYear(), today.getMonth() + 1, 6),
                           +new Date(today.getFullYear(), today.getMonth() + 1, 7),
                           +new Date(today.getFullYear(), today.getMonth() + 1, 25),
                           +new Date(today.getFullYear(), today.getMonth() + 1, 27),
                           +new Date(today.getFullYear(), today.getMonth() - 1, 3),
                           +new Date(today.getFullYear(), today.getMonth() - 1, 5),
                           +new Date(today.getFullYear(), today.getMonth() - 2, 22),
                           +new Date(today.getFullYear(), today.getMonth() - 2, 27)
                        ];
				  $("#calendar").kendoCalendar({
                        value: today,
                      change:onChange,
                        dates: events,
                        weekNumber: false,
                        month: {
                            // template for dates in month view
                            content: '# if ($.inArray(+data.date, data.dates) != -1) { #' +
                                        '<div class="' +
                                           '# if (data.value < 10) { #' +
                                               "exhibition" +
                                           '# } else if ( data.value < 20 ) { #' +
                                               "party" +
                                           '# } else { #' +
                                               "cocktail" +
                                           '# } #' +
                                        '">#= data.value+"<br>Hello" #</div>' +
                                     '# } else { #' +
                                     '#= data.value #' +
                                     '# } #'
                            
                        },
                        footer: false
                    });
				 ETCalendarWindow.data("kendoWindow").open();
			 });
            $('#btnETInspections').click(function () {
                ETInspectWindow.data("kendoWindow").open();
                var uesrid = "2"; var Type = "POST";              
                var Url = serviceURLs["inspectionslist"];;
                var Data = '{"Id": "' + uesrid + '"}';
                var ContentType = "application/json; charset=utf-8";
                var DataType = "json";

                $.ajax({
                    type: Type,
                    url: Url,
                    data: Data,
                    contentType: ContentType,
                    dataType: DataType,
                    processdata: true,
                    success: function (msg) {
                        GetinspectionsListSucceeded(msg);
                        //alert("success");
                    },
                    error: ServiceFailed// When Service call fails
                });
            
            });

            function toDate(value) {


                var dateRegExp = /^\/Date\((.*?)\)\/$/;
                var date = dateRegExp.exec(value);
                return new Date(parseInt(date[1]));
            }
    
            function GetinspectionsListSucceeded(result) {

                
                resultObject = eval(result.GetInspectionsListResult);

                console.log(resultObject);
                $("#datagridinspections").kendoGrid({

                    dataSource: {
                        data: resultObject

                    },
                    dataBound: function() {
                        this.expandRow(this.tbody.find("tr.k-master-row"));
                    },
                    detailInit: detailInit,
                    dataBound: function () {
                        // this.expandRow(this.tbody.find("tr.k-master-row").first());

                        $('td').each(function () { if ($(this).text() == 'Pedning') { $(this).addClass('orange') } });
                        $('td').each(function () { if ($(this).text() == 'Completed') { $(this).addClass('green') } });
                        $('td').each(function () { if ($(this).text() == 'In-Progress') { $(this).addClass('orange') } });
                    },

                    columns: [{ field: "TankID", title: "Tank ID", width: "80px" },
            { field: "Inspection_name", title: "Inspection Name", width: "120px" },
           
            { field: "Created_date", title: "Created Date", width: "90px", template: "#= kendo.toString(kendo.parseDate(Created_date, 'yyyy-MM-dd'), 'MM/dd/yyyy') #" },
            { field: "Status", title: "Status", width: "100px" },
           
             { field: "due_date", title: "Due Date", width: "90px", template: "#= kendo.toString(kendo.parseDate(due_date, 'yyyy-MM-dd'), 'MM/dd/yyyy') #" },]
             //{ field: "completed_date", title: "Completed Date", width: "90px"}]
             
                });


              
               
            }
         

            function detailInit(e) {

                var uesrid = "2"; var Type = "POST";
                var Url = serviceURLs["inspectionshistory"];;
                var Data = '{"Id": "' + e.data.TankID + '"}';
                var ContentType = "application/json; charset=utf-8";
                var DataType = "json";

                $("#txttankid").val(e.data.TankID);

                $.ajax({
                    type: Type,
                    url: Url,
                    data: Data,
                    contentType: ContentType,
                    dataType: DataType,
                    processdata: true,
                    success: function (msg) {
                        //GetinspectionsListSucceeded(msg);
                        //alert("success");

                       // console.log(msg);
                        resultObject = eval(msg.GetInspectionsHistoryResult);

                     //   console.log(msg.GetInspectionsHistory);
                        $("<div/>").appendTo(e.detailCell).kendoGrid({


                            dataSource: resultObject,
                            scrollable: false,
                            dataBound: function () {
                                // this.expandRow(this.tbody.find("tr.k-master-row").first());

                                $(".btnaddcomments").click(function (e) {
                                    //alert("test");

                                   detailsWindow.data("kendoWindow").open();
                                });

                            },

                            columns: [
                                { field: "Comments", title: "Comments", width: "100px", headerTemplate: "<button Comments class='btnaddcomments'>Add Comments</button>" },

                     { field: "updateby", title: "Updated By", width: "100px", },
                     { field: "CommentCreated_date", title: "Date", width: "100px", template: "#= kendo.toString(kendo.parseDate(CommentCreated_date, 'yyyy-MM-dd'), 'MM/dd/yyyy') #" }
                     
                               

                     
                            ]
                        });
                    },
                    error: ServiceFailed// When Service call fails
                });
                $('#txttankid').val = e.data.TankID;
                console.log(e.data.TankID);
              
            }
            $('#btncommentsupdate').click(function () {

                var comments = $('#txtcomments').val();

                var updatedby = $('#txtUpdatedby').val();

                var tankid = $('#txttankid').val();
               

              

                var Url = serviceURLs["uploadinspectionhistory"];
                // var Data = '{"type": "' + resultObject + '","fn":"' + fn + '"}';
                var Data = '{"TankID": "' + tankid + '","comment": "' + comments + '","updatedby":"' + updatedby + '"}';
                //alert(Data);
                var ContentType = "application/json; charset=utf-8";

                $.ajax({
                    type: 'POST',
                    url: Url,
                    data: Data,
                    contentType: ContentType,
                    dataType: 'json',
                    processdata: true,
                    success: function (msg) {
                       // //GetFilesListSucceeded(msg);
                        alert("success");
                       // console.log(msg);
                       //// alert(msg);
                     
                    },
                    error: ServiceFailed// When Service call fails
                });

                
            });
         
			function  showTabSelection(obj)
			{
				$('#thair').removeClass('tabSelected').addClass('tabNotSelected');
				$('#thwaste').removeClass('tabSelected').addClass('tabNotSelected');
				$('#thwater').removeClass('tabSelected').addClass('tabNotSelected');
				$('#thother').removeClass('tabSelected').addClass('tabNotSelected');
				 obj.addClass('tabSelected');
			}
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////
            $('#btnRead').click(function () {
                var x = document.getElementById("uploadFiles");

                var file = x.files[0];
                var fileData = file;

                var dropdownlist = $("#category").data("kendoDropDownList");

                var dropdownSubCat_type = $("#subcategory").data("kendoDropDownList");

                var category = $("#category").data("kendoDropDownList").value();

                var SubCat_type = $("#subcategory").data("kendoDropDownList").value();
                
              

             
                var Url = serviceURLs["uploadcustomfile"];

                var parent = $("#divcategorysubcategory").jstree().get_selected(true)[0].id;

              

              
              
                $.ajax({
                    url: Url,
                    type: 'POST',
                    data: fileData,
                    cache: false,
                    dataType: 'json',
                    processData: false, // Don't process the files
                    contentType: false, // Set content type to false as jQuery will tell the server its a query string request
                    success: function (data) {
                        UploadFileServiceSucceeded(data, file.name, category, SubCat_type, parent, "File");


                    },
                    error: function (result) {
                        alert('Service call failed: ' + result.status + '' + result.statusText);
                    }
                });

            });
            ////////////////////////////////////////////////////////////////////////////
            function UploadFileServiceSucceeded(result, fn, category, SubCat_type, parent,type) {

                resultObject = result.UploadCustomFileResult;    
              
            
                if (parent === "#")
                {
                    resultObjectp = eval(resulparent.GetFilesListResult);

                    var parent = JSLINQ(resultObjectp)
                       .Where(function (item) { return item.Cat_Name ==category && item.SubCat_type == SubCat_type });
                }

               
				var Url=serviceURLs["fixuploadfile"];
               // var Data = '{"type": "' + resultObject + '","fn":"' + fn + '"}';
				var Data = '{"type": "' + resultObject + '","fn":"' + fn + '","category":"' + category + '","SubCat_type":"' + SubCat_type + '","parent":"' + parent + '"}';
               // alert(Data);
                var ContentType = "application/json; charset=utf-8";

                $.ajax({
                    type: 'POST',
                    url: Url,
                    data: Data,
                    contentType: ContentType,
                    dataType: 'json',
                    processdata: true,
                    success: function (msg) {
                        //GetFilesListSucceeded(msg);
                        alert(msg.FixUploadedFileResult);
                        oncategoryChange();
                    },
                    error: ServiceFailed// When Service call fails
                });


            }
            ///////////////////////////////////////////////////////////////////////////////////////////////////////
});